apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  annotations:
    tsb.tetrate.io/tenant: {{ tenantName }}
    tsb.tetrate.io/organization: {{ orgName }}
    tsb.tetrate.io/trafficGroup: {{ trafficGroupName }}
    tsb.tetrate.io/workspace: {{ workspaceName }}
  name: {{ serviceRouteName }}
  namespace: {{ (namespaces and namespaces["reviews"]) or namespace }}
spec:
  gateways:
  - mesh
  hosts:
  - {{ reviewsHostFQDN }}
  http:
  - route:
    - destination:
        host: {{ reviewsHostFQDN }}
        subset: v1
      weight: 60
    - destination:
        host: {{ reviewsHostFQDN }}
        subset: v2
      weight: 30
    - destination:
        host: {{ reviewsHostFQDN }}
        subset: v3
      weight: 10
